---
title: "Repro Spano et al 2018"
author: "mhorger"
date: "March 25, 2019"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE, warning=FALSE, message = FALSE, eval = FALSE)
```




## Introduction 
General summary of the article: 
- naps are beneficial for learning in typically developing infants, children, and adults. 
- individuals with Down syndrome have a high rate of disordered sleep than seen in the typical populaiton. Do they experience the same benefits of sleep on learning? 

- Methods - 
Assess retention of new words with various intervals between training and test. Children receive all conditions 1-2 weeks apart
1. after a 5 min delay
2. after a nap (4 hour delay)
3. after 24 hours 
- Planned analysis - 
The first analysis conducted was a repeated measures ANOVA for both wake and nap conditions. The second was a 2x2 ANOVA with delay type as the repeated factor and TD or DS as the between. These were conducted for the 4 and 24 hour delay. 


## Re-analysis 

### Participants 
```{r}
Groups<- c( "DS", "TD")
N <- c(25, 24)
Mean_age <- c(9.49, 5.03)
PercentFemale <- c(52, 54)

demos<- data.frame(Groups, N, Mean_age, PercentFemale)
library(xtable)
knitr::kable(xtable(demos))
```


### Pre-processing and conversion to long format 

```{r, eval=FALSE}

ChangeinRec <- c(as.numeric(unlist(Spano_et_al[,11])),
         as.numeric(unlist(Spano_et_al[,12])),
         as.numeric(unlist(Spano_et_al[,13])),
         as.numeric(unlist(Spano_et_al[,14]))
         )

Group <- 
  rep(c("DS"), 25)
Group<-
  c(Group, rep(c("TD"), 24))
Group<- 
  c(rep(Group, 4))

Subjects <- rep(seq(1:49), 4) 

Condition <- 
  rep(rep(c("WAKE", "SLEEP"), each = 49), 2)

Delay <- 
  rep(c(4, 24), each = 98)

Spano <- data.frame(Subjects, Group, Condition, Delay, ChangeinRec)

```

##Analysis 
The first analysis conducted was a repeated measures ANOVA for both wake and nap conditions.
```{r}
Spano$Subjects<- factor(Spano$Subjects)

class(Spano$Subjects)

sum_df<- Spano %>%
          group_by(Subjects,Condition) %>%
          summarise(mCR =mean(ChangeinRec))

ANOVA1<- aov(mCR~Condition + Error(Subjects/(Condition)), sum_df)
summary(ANOVA1)

apa_aov <- apa_print(summary(ANOVA1))
apa_table(
  apa_aov$table
  , caption = "ANOVA table for Experiment 1"
)
```

The second was a 2x2 ANOVA with delay type as the repeated factor and TD or DS as the between. These were conducted for the 4 and 24 hour delay. 

```{r}
Change4hr <- ChangeinRec[1:98]
Change24hr <- ChangeinRec[99:196]
GroupPerHr <- Group[1:98]
CondPerHr <- Condition[1:98]

TwentyFourHrDelay<- data.frame(Subjects,GroupPerHr, CondPerHr, Change24hr)

FourHrDelay <- data.frame(Subjects,GroupPerHr, CondPerHr, Change4hr)

ANOVA24<- aov(Change24hr~GroupPerHr*CondPerHr + Error(Subjects/(CondPerHr)), TwentyFourHrDelay) 
summary(ANOVA24)

ANOVA4 <-  aov(Change4hr~GroupPerHr*CondPerHr + Error(Subjects/(CondPerHr)), FourHrDelay) 
summary(ANOVA4)

summary_out_4HRS <- summary(ANOVA4)
library(xtable)
knitr::kable(xtable(summary_out_4HRS))


summary_out_24HRS <- summary(ANOVA24)
library(xtable)
knitr::kable(xtable(summary_out_24HRS))
```
##Table of means 
```{r}
overall_means <- FigureItOut %>%
                  group_by(Grouping, Timing) %>%
                  summarise(meanNTC = mean(NumToCriterion),
                            SEMNTC = (sd(NumToCriterion)/sqrt(length(NumToCriterion))))


overall_means<- data.frame(overall_means)

# make a table of overall means
knitr::kable(overall_means)
```



## Reproducing the figure 

I will focus on the figure that depicts Repetitions required to meet criterion 

```{r}
NumToCriterion<- c(as.numeric(unlist(Spano_et_al[,7])),
         as.numeric(unlist(Spano_et_al[,8])),
         as.numeric(unlist(Spano_et_al[,9]))
         )
Timing<- rep(c("Immediate", "Wake", "Sleep"), each = 49)

Subs <- rep(c(seq(1:49)), 3)
Subs<- as.factor(Subs)

Grouping<-
  rep(c("DS"), 25)
Grouping<-
  c(Grouping, rep(c("TD"), 24))
Grouping<- 
  c(rep(Grouping, 3))

FigureItOut <- data.frame(Subs, Grouping, Timing, NumToCriterion)


ggplot(overall_means, aes(x=Timing,
                          y= meanNTC, 
                          group=Grouping,
                          fill=Grouping))+
  geom_bar( col=brewer.pal(n = 6, name = "RdBu"),
    stat="identity",
    position="dodge")+
  theme_classic(base_size=12)+
  ylab("Repetition required to meet criterion")+
  geom_errorbar( aes(ymin=meanNTC-SEMNTC,
                    ymax=meanNTC+SEMNTC),
                position=position_dodge(width=0.9),
                width=.2,
                color="black")+
  coord_cartesian(ylim=c(0.0, 2.5))


```

